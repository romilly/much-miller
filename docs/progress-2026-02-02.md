# Progress Report: 2 February 2026

## Summary

Phase 1 of the Much re-architecture is complete. The core voice loop is working:
wake word detection → TTS response → transcription → "over" to return.

## What Was Done

### Technology Validation

| Component | Host | Result |
|-----------|------|--------|
| OpenAI Whisper (GPU) | polwarth | ✓ 5.18s for 30s audio with medium model |
| OpenAI Whisper (GPU) | xavier | ✓ Installed but CUDA unavailable (needs NVIDIA's Jetson PyTorch) |
| RealtimeSTT + faster-whisper | trend | ✓ Working on CPU with small model |
| openWakeWord | trend | ✓ Detects "hey jarvis", "alexa", "hey mycroft" reliably |

### Code Changes

**Removed** (old VAD-based approach):
- `ports/transcriber.py`, `streaming_transcriber.py`, `voice_detector.py`
- `adapters/http_transcriber.py`, `websocket_transcriber.py`, `webrtc_voice_detector.py`
- `adapters/fake_transcriber.py`, `fake_voice_detector.py`
- `detector.py` (text-based wake word detection)
- All associated tests

**Kept** (still needed):
- `ports/speaker.py`, `audio_recorder.py`
- `adapters/piper_speaker.py`, `sounddevice_recorder.py`
- `adapters/fake_speaker.py`, `fake_recorder.py`
- Associated tests

**New** `main.py`:
- Uses openWakeWord for wake word detection
- Uses RealtimeSTT/faster-whisper for transcription
- Uses Piper for TTS ("Hello Romilly")
- Device selection by name (e.g., "Samson") for portability
- "over" keyword returns to wake word listening

### Dependencies Updated

Added:
- `openwakeword` - wake word detection
- `RealtimeSTT` - real-time transcription (pulls in faster-whisper)
- `pyaudio` - audio capture for openWakeWord
- `requests` - required by faster-whisper for model downloads

Removed:
- `webrtcvad` - no longer using VAD-based approach
- `websockets` - no longer using WebSocket streaming
- `httpx` - no longer using HTTP transcriber

### Learnings

1. **RealtimeSTT uses faster-whisper, not OpenAI Whisper** - The original plan assumed we could use OpenAI Whisper as a backend, but RealtimeSTT is built on faster-whisper. This is actually better (4x faster).

2. **Jetson CUDA requires special PyTorch** - Standard pip-installed PyTorch doesn't have Jetson GPU support. Would need NVIDIA's wheels, but xavier is disk-space constrained (91% full).

3. **Audio device numbering is unstable** - USB audio devices renumber on reboot. Solution: match devices by name substring instead of index.

4. **ALSA/JACK warnings are cosmetic** - Set `JACK_NO_START_SERVER=1` to suppress JACK warnings. ALSA warnings about missing devices are harmless.

5. **sounddevice gives better device names than PyAudio** - Use sounddevice for device enumeration even when using PyAudio for capture.

## Current State

```
[Microphone] → [openWakeWord] → "hey jarvis" detected
                                      ↓
                              [Piper TTS] → "Hello Romilly"
                                      ↓
                              [RealtimeSTT] → transcribe speech
                                      ↓
                              print transcription
                                      ↓
                              ends with "over"? → back to wake word
```

Running on **trend** (CPU-only). Transcription latency is acceptable for a prototype.

## Next Steps

1. **Custom wake word** - "hey much" training in progress via openwakeword.com
2. **transcription-service** - FastAPI on polwarth for GPU-accelerated transcription
3. **Intent routing** - Claude API for command interpretation
4. **First integration** - Music/radio control

## Files Changed

```
M  README.md
M  requirements.txt
M  src/much_miller/main.py
M  src/much_miller/wake_word/adapters/__init__.py
M  src/much_miller/wake_word/ports/__init__.py
D  src/much_miller/wake_word/adapters/fake_transcriber.py
D  src/much_miller/wake_word/adapters/fake_voice_detector.py
D  src/much_miller/wake_word/adapters/http_transcriber.py
D  src/much_miller/wake_word/adapters/webrtc_voice_detector.py
D  src/much_miller/wake_word/adapters/websocket_transcriber.py
D  src/much_miller/wake_word/detector.py
D  src/much_miller/wake_word/ports/streaming_transcriber.py
D  src/much_miller/wake_word/ports/transcriber.py
D  src/much_miller/wake_word/ports/voice_detector.py
D  tests/wake_word/test_detector.py
D  tests/wake_word/test_main.py
D  tests/wake_word/test_streaming_transcriber.py
D  tests/wake_word/test_transcriber.py
D  tests/wake_word/test_voice_detector.py
A  docs/progress-2026-02-02.md
```
